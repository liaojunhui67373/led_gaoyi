<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>开关</title>
  <script src="../static/vue/vue.js"></script>
  <script src="../static/axios/axios.min.js"></script>
  <script src="../static/jquery/jquery-3.5.1.min.js"></script>
</head>

<body>

  <!--全开-->
  <p><input type="button" value="开启所有" style="width: 100px; height: 50px" id="openAllBtn" onclick="openAllLed()"></p>
  <!--全关-->
  <p><input type="button" value="关闭所有" style="width: 100px; height: 50px" id="closeAllBtn" onclick="closeAllLed()"></p>
  <br>


  <!--添加设备-->
  <div>添加设备 <input type="text" id="devName" placeholder="请输入设备名称"><span><input type="button" value="确认" id="addDev"
        onclick="addDev()"></span></div><br>


  <!--所有设备-->
  <div class="ledName">

    已绑定的设备:<br><br>

    <input v-for="item in dev.devlist" type="button" :value="item.dev_name" @click="switchLed(item.dev_id)"
      style="width: 100px; height: 50px"></input>
  </div><br><br>


  <!--设备详情-->
  <div id="detail">
    设备详情:
    <ul>
      <li v-for="item in dev.devlist">
        设备ID：{{item.dev_id}} &nbsp &nbsp &nbsp &nbsp 设备名称: {{item.dev_name}} <span><input type="button" value="修改"
            @click="updateName(item.dev_id)"></span>

      </li>
    </ul>
  </div>

  <!--二维码-->
  <div>
    <img src="../static/image/0d1102636fdf36cdff2f9fefbfc5393.jpg"
      style="margin-top: -250px; margin-left: 800px; float: left;">
  </div>

  <script>


    //开关灯函数
    window.onload = function () {
      let flag = true;
      $.ajax({
        url: "/showAllDev",
        type: "get",
        data: "json",
        success: function (data) {
          let dev = JSON.parse(data);
          let showVue = new Vue({
            el: '.ledName',
            data: {
              dev
            },
            methods: {
              switchLed(string) {
                if (flag) {
                  let oReq = new XMLHttpRequest();
                  oReq.open('GET', '/openLed?id=' + string);
                  oReq.send(null);
                  flag = false;
                } else {
                  let oReq = new XMLHttpRequest();
                  oReq.open('GET', '/closeLed?id=' + string);
                  oReq.send(null);
                  flag = true;
                }

              }
            }
          });

          //设备详情
          let detailVue = new Vue({
            el: '#detail',
            data: {
              dev
            },
            methods: {
              updateName(string) {
                let name = prompt();
                $.ajax({
                  url: '/updateName?id=' + string + '&name=' + name,
                  async: false,
                  type: "get",
                  data: "json",
                  success: function (data) {
                    if (data == 'success') {
                      alert('修改成功');
                    } else {
                      alert('修改失败')
                    }
                  }
                })
              }
            }
          });
        }
      })
    }

    //开启所有灯
    function openAllLed() {
      let oReq = new XMLHttpRequest();
      oReq.open('GET', '/allON');
      oReq.send(null);
    }

    //关闭所有灯
    function closeAllLed() {
      let oReq = new XMLHttpRequest();
      oReq.open('GET', '/allOFF');
      oReq.send(null);
    }

    //添加设备
    function addDev() {
      $.ajax({
        url: '/addDev?devName=' + $("#devName").val(),
        type: "get",
        data: "json",
        success: function (data) {

          if (data == 'success') {
            $("#devName").val("");
            alert('添加成功');
          } else {
            alert('没有找到要添加的设备');
            $("#devName").val("");
          }
        }
      })
    }

  </script>
</body>

</html>