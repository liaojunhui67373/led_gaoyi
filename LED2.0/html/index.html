<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>开关</title>
  <script src="../static/vue/vue.js"></script>
  <script src="../static/axios/axios.min.js"></script>
  <script src="../static/jquery/jquery-3.5.1.min.js"></script>
</head>

<body>

  <!--全开-->
  <p><input type="button" value="开启所有" style="width: 100px; height: 50px" id="openAllBtn" onclick="openAllLed()"></p>
  <!--全关-->
  <p><input type="button" value="关闭所有" style="width: 100px; height: 50px" id="closeAllBtn" onclick="closeAllLed()"></p>
  <br>


  <!--添加设备-->
  <div>添加设备 <input type="text" id="devName" placeholder="请输入设备名称">
    <span><input type="button" value="确认" id="addDev" onclick="addDev()">
    </span>
  </div><br>

  <!--设备详情-->
  <h3>已绑定设备:</h3>
  <div id="detail">
    <li v-for="item in dev.devlist"><br>

      <!--设备ID：{{item.dev_id}} &nbsp &nbsp &nbsp &nbsp--> 设备名称: {{item.dev_name}}

      <span style="position: absolute; left: 225px;"><input type="button" value="开灯" @click="openLed(item.dev_id)"
          style="height: 30px; width: 70px;">
      </span>

      <span style="position: absolute; left: 300px;"><input type="button" value="关灯" @click="closeLed(item.dev_id)"
          style="height: 30px; width: 70px;">
      </span>

      <span style="position: absolute; left: 375px;"><input type="button" value="修改" @click="updateName(item.dev_id)"
          style="height: 30px; width: 70px;">
      </span>
    </li>
  </div>
  <!--二维码-->
  <div>
    <img src="../static/image/0d1102636fdf36cdff2f9fefbfc5393.jpg" style="position: relative; bottom: -300px;">
  </div>

  <script>




    //开关灯函数
    window.onload = function () {
      $.ajax({
        url: "/showAllDev",
        type: "get",
        data: "json",
        success: function (data) {
          let dev = JSON.parse(data);

          //设备详情
          let detailVue = new Vue({
            el: '#detail',
            data: {
              dev
            },
            methods: {
              updateName(string) {
                let name = prompt();
                if (name == null) {
                  return
                } else {
                  axios.get('/updateName?id=' + string + '&name=' + name).then(function (response) {
                    if (response.data == 'success') {
                      alert('修改成功');
                      window.location.reload()
                    } else {
                      console.log(response)
                      alert('修改失败')
                    }
                  })
                }
              },
              //开灯
              openLed(string) {
                axios.get('/openLed?id=' + string);
              },

              //关灯
              closeLed(string) {
                axios.get('/closeLed?id=' + string)
              },
            }
          })
        }
      })
    }

    //开启所有灯
    function openAllLed() {
      axios.get('/allON')
    }

    //关闭所有灯
    function closeAllLed() {
      axios.get('/allOFF')
    }

    function addDev() {
      axios.get('/addDev?devName=' + $("#devName").val()).then(function (response) {
        if (response.data == 'success') {
          $("#devName").val("");
          alert('添加成功');
        } else {
          console.log(response);
          alert('没有找到要添加的设备');
          $("#devName").val("");
        }
      })
    }
  </script>
</body>


</html>